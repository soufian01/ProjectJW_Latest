<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CoachKat</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="max-w-5xl mx-auto p-6">
    <div class="flex items-center justify-between">
      <div class="flex-1"></div>

      <div class="flex-1 text-center">
        <h1 class="text-4xl font-extrabold">CoachKat</h1>
        <p class="text-xl text-gray-400 mt-1">Personal Coaching</p>
      </div>

      <div class="flex-1 flex items-center justify-end">
        <button id="themeToggle" type="button" class="text-sm px-3 py-1 rounded bg-gradient-to-r from-purple-500 to-indigo-500 text-white">Toggle theme</button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- About -->
    <section class="lg:col-span-1 bg-white rounded-xl p-5 shadow">
      <h2 class="text-xl font-semibold mb-2">About</h2>
      <p class="text-sm leading-relaxed">
        I help students and early-career professionals structure time, focus deeply, and hit outcomes.
      </p>
    </section>

    <!-- Videos -->
    <section class="lg:col-span-2 bg-white rounded-xl p-5 shadow">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Video Library</h2>
        <button id="refreshBtn" class="text-sm underline">Refresh</button>
      </div>
      <div id="videoList" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">Loadingâ€¦</div>
      <div id="player" class="mt-4 hidden">
        <video id="videoEl" class="w-full rounded-lg" controls></video>
        <p id="nowPlaying" class="text-xs text-gray-600 mt-1"></p>
      </div>
    </section>

    <!-- Contact -->
    <section class="lg:col-span-3 bg-white rounded-xl p-5 shadow">
      <h2 class="text-xl font-semibold">Contact Request</h2>
      <form id="contactForm" class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
        <label class="sr-only" for="name">Name</label>
        <input id="name" name="name"  class="border rounded px-3 py-2" placeholder="Your name" required />

        <label class="sr-only" for="email">Email</label>
        <input id="email" name="email" type="email" class="border rounded px-3 py-2" placeholder="Email" required />

        <label class="sr-only" for="message">Message</label>
        <textarea id="message" name="message" class="border rounded px-3 py-2 md:col-span-2" placeholder="What do you need help with?" required></textarea>

        <button type="submit" class="bg-black text-white rounded px-4 py-2 md:col-span-1">Send</button>
      </form>
      <p id="contactStatus" class="text-sm mt-2" aria-live="polite"></p>
    </section>
  </main>

  <!-- Find Us Section -->
  <section id="find-us" class="mt-8 max-w-5xl mx-auto p-6">
    <h3 class="text-lg font-semibold">Find Us</h3>
    <button id="showLocationBtn" type="button" class="mt-2 inline-block px-4 py-2 rounded bg-purple-600 text-white">Show location</button>
    <div id="mapContainer" class="mt-4 w-full"></div>
  </section>

  <script>
    // Theme: dark mode with purple accent
    (function(){
      const root = document.documentElement;
      const themeToggle = document.getElementById('themeToggle');
      const applyTheme = (t) => {
        if(t === 'dark') {
          root.classList.add('dark');
          localStorage.setItem('theme','dark');
        } else {
          root.classList.remove('dark');
          localStorage.setItem('theme','light');
        }
      };
      const saved = localStorage.getItem('theme') || 'dark';
      applyTheme(saved);
      themeToggle.addEventListener('click', ()=> applyTheme(document.documentElement.classList.contains('dark') ? 'light' : 'dark'));
    })();

    // Load videos
    const videoListEl = document.getElementById('videoList');
    const player = document.getElementById('player');
    const videoEl = document.getElementById('videoEl');
    const nowPlaying = document.getElementById('nowPlaying');

    async function loadVideos() {
      try {
        const res = await fetch('/api/videos');
        if (!res.ok) throw new Error('Network response was not ok');
        const data = await res.json();
        if (!Array.isArray(data) || data.length === 0) {
          videoListEl.innerHTML = '<p class="text-gray-500">No videos yet.</p>'; return;
        }
        videoListEl.innerHTML = '';
        data.forEach(v => {
          const card = document.createElement('button');
          card.className = 'text-left border rounded p-3 hover:bg-gray-50';
          const title = document.createElement('p');
          title.className = 'font-medium';
          title.textContent = v.title || 'Untitled';
          const dur = document.createElement('p');
          dur.className = 'text-xs text-gray-500';
          dur.textContent = `${v.durationSeconds || 0}s`;
          card.appendChild(title);
          card.appendChild(dur);
          card.addEventListener('click', () => {
            videoEl.src = v.url; nowPlaying.textContent = 'Now playing: ' + v.title;
            player.classList.remove('hidden'); videoEl.play();
          });
          videoListEl.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        videoListEl.textContent = 'Failed to load videos.';
      }
    }
    document.getElementById('refreshBtn').addEventListener('click', loadVideos);

    // Contact form submission
    document.getElementById('contactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const fd = new FormData(form);
      const body = { name: fd.get('name'), email: fd.get('email'), message: fd.get('message') };
      const out = document.getElementById('contactStatus');
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      try {
        const res = await fetch('/api/contact', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
        if (res.ok) {
          out.textContent = 'Thanks! I will get back to you shortly.'; out.className = 'text-sm mt-2 text-green-600'; form.reset();
        } else {
          const err = await res.json().catch(()=>({})); out.textContent = 'Error: ' + (err.error || 'could not send'); out.className = 'text-sm mt-2 text-red-600';
        }
      } catch (err) { console.error(err); out.textContent = 'Network error'; out.className = 'text-sm mt-2 text-red-600'; }
      finally { submitBtn.disabled = false; }
    });

    // Show location
    async function showLocation() {
      const btn = document.getElementById('showLocationBtn');
      const container = document.getElementById('mapContainer');
      btn.disabled = true;
      container.innerHTML = 'Loading...';
      try {
        container.innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d80429.06496168647!2d6.78540945053099!3d50.953155244112985!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47bf2572d0d7e601%3A0xac339addcd4e3c68!2sXTRAFIT%20K%C3%B6ln-Ehrenfeld!5e0!3m2!1sen!2sde!4v1761516792559!5m2!1sen!2sde" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
      } catch (err) {
        container.textContent = 'Unable to load location.';
        console.error(err);
      } finally {
        btn.disabled = false;
      }
    }
    document.getElementById('showLocationBtn').addEventListener('click', showLocation);

    loadVideos();
  </script>
</body>
</html>
